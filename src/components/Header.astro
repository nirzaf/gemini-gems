---
import { Gem, Sparkles, Github, LogIn, LogOut } from "lucide-astro";
---

<header class="gradient-bg hero-pattern">
  <div class="container mx-auto px-4 py-2">
    <!-- Top Navigation -->
    <nav class="flex items-center justify-between mb-2">
      <a
        href="/"
        class="flex items-center gap-2 text-white font-bold"
      >
        <Gem class="w-5 h-5" />
        <span class="sr-only">Gemini Gems Home</span>
        <span aria-hidden="true">Gemini Gems</span>
      </a>
      <div class="hidden sm:flex items-center gap-4 text-sm">
        <a
          href="/#gems"
          class="text-white/80 hover:text-white transition-colors"
          >Browse Gems</a
        >
        <a
          href="https://github.com/nirzaf/gemini-gems"
          target="_blank"
          class="text-white/80 hover:text-white transition-colors">GitHub</a
        >
      </div>
      <button
        onclick="toggleTheme()"
        class="theme-toggle-btn p-2 rounded-lg backdrop-filter backdrop-blur-lg bg-white bg-opacity-20 border border-white border-opacity-30 text-white hover:bg-opacity-30 transition-all duration-300 group"
        title="Toggle theme"
        aria-label="Toggle dark mode"
      >
        <svg
          class="w-4 h-4 group-hover:scale-110 transition-transform duration-200"
          fill="currentColor"
          viewBox="0 0 20 20"
        >
          <path
            class="dark:hidden"
            d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"
          ></path>
          <path
            class="hidden dark:block"
            d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"
          ></path>
        </svg>
      </button>

      <!-- Auth Section -->
      <div id="authSection" class="flex items-center gap-4 ml-4">
        <button
          id="loginBtn"
          class="text-white/80 hover:text-white text-sm flex gap-2 items-center"
        >
          <LogIn class="w-4 h-4" /> Login
        </button>
        <div id="userProfile" class="hidden flex items-center gap-4">
          <span id="userName" class="text-sm text-white"></span>
          <button
            id="logoutBtn"
            class="text-white/80 hover:text-white"
            title="Logout"
          >
            <LogOut class="w-4 h-4" />
          </button>
        </div>
      </div>
    </nav>

    <!-- Auth Modal -->
    <div
      id="authModal"
      class="fixed inset-0 z-[100] hidden flex items-center justify-center bg-black/80 backdrop-blur-sm"
    >
      <div
        class="bg-[#161b22] border border-white/10 rounded-xl p-6 w-full max-w-md relative shadow-2xl"
      >
        <button
          id="closeModal"
          class="absolute top-4 right-4 text-gray-400 hover:text-white"
        >
          <svg
            class="w-5 h-5"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
            ><path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M6 18L18 6M6 6l12 12"></path></svg
          >
        </button>

        <!-- Tabs -->
        <div class="flex gap-4 mb-6 border-b border-white/10">
          <button
            id="tabLogin"
            class="pb-2 text-sm font-bold text-white border-b-2 border-blue-500"
            >Login</button
          >
          <button
            id="tabSignup"
            class="pb-2 text-sm font-bold text-gray-400 hover:text-white"
            >Sign Up</button
          >
        </div>

        <!-- Login Form -->
        <form id="loginForm" class="space-y-4">
          <div>
            <label class="block text-xs text-gray-400 mb-1">Email</label>
            <input
              type="email"
              name="email"
              required
              class="w-full bg-black/20 border border-white/10 rounded-lg px-3 py-2 text-white text-sm focus:border-blue-500 outline-none"
              placeholder="you@example.com"
            />
          </div>
          <div>
            <label class="block text-xs text-gray-400 mb-1">Password</label>
            <input
              type="password"
              name="password"
              required
              class="w-full bg-black/20 border border-white/10 rounded-lg px-3 py-2 text-white text-sm focus:border-blue-500 outline-none"
              placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
            />
          </div>
          <div id="loginError" class="text-red-400 text-xs hidden"></div>
          <button
            type="submit"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded-lg text-sm transition-colors"
          >
            Login
          </button>
        </form>

        <!-- Signup Form -->
        <form id="signupForm" class="hidden space-y-4">
          <div>
            <label class="block text-xs text-gray-400 mb-1">Name</label>
            <input
              type="text"
              name="name"
              required
              class="w-full bg-black/20 border border-white/10 rounded-lg px-3 py-2 text-white text-sm focus:border-blue-500 outline-none"
              placeholder="Your Name"
            />
          </div>
          <div>
            <label class="block text-xs text-gray-400 mb-1">Email</label>
            <input
              type="email"
              name="email"
              required
              class="w-full bg-black/20 border border-white/10 rounded-lg px-3 py-2 text-white text-sm focus:border-blue-500 outline-none"
              placeholder="you@example.com"
            />
          </div>
          <div>
            <label class="block text-xs text-gray-400 mb-1">Password</label>
            <input
              type="password"
              name="password"
              required
              minlength="8"
              class="w-full bg-black/20 border border-white/10 rounded-lg px-3 py-2 text-white text-sm focus:border-blue-500 outline-none"
              placeholder="Min 8 chars"
            />
          </div>
          <div id="signupError" class="text-red-400 text-xs hidden"></div>
          <button
            type="submit"
            class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 rounded-lg text-sm transition-colors"
          >
            Create Account
          </button>
        </form>
      </div>
    </div>

    <div class="text-center">
      <h1
        class="text-2xl md:text-3xl font-bold mb-2 header-text-enhanced fade-in flex items-center justify-center gap-2"
      >
        <Gem class="w-6 h-6" />
        Gemini Gems
      </h1>
      <div class="max-w-2xl mx-auto mb-2 slide-up">
        <p class="header-description text-xs md:text-sm leading-snug">
          ðŸš€ <strong>Supercharge your AI</strong> with expert prompts! âœ¨ Transform
          Gemini into <strong>specialized assistants</strong> ðŸ’Ž <strong
            >Ready-to-use</strong
          > professional prompts
        </p>
      </div>
      <div class="flex flex-col sm:flex-row gap-2 justify-center fade-in">
        <a
          href="/#gems"
          class="btn-primary text-sm px-5 py-2 inline-flex items-center justify-center gap-1"
        >
          <Sparkles class="w-3 h-3" />
          Explore Gems
        </a>
      </div>
    </div>
  </div>
</header>

<script>
  import { account, client } from "../lib/appwrite";
  import { ID } from "appwrite";

  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const userProfile = document.getElementById("userProfile");
  const userName = document.getElementById("userName");
  const authModal = document.getElementById("authModal");
  const closeModal = document.getElementById("closeModal");
  const tabLogin = document.getElementById("tabLogin");
  const tabSignup = document.getElementById("tabSignup");
  const loginForm = document.getElementById("loginForm");
  const signupForm = document.getElementById("signupForm");
  const loginError = document.getElementById("loginError");
  const signupError = document.getElementById("signupError");

  // Modal Logic
  loginBtn?.addEventListener("click", () => {
    authModal?.classList.remove("hidden");
  });

  closeModal?.addEventListener("click", () => {
    authModal?.classList.add("hidden");
  });

  // Tab Switching
  tabLogin?.addEventListener("click", () => {
    tabLogin?.classList.add("text-white", "border-blue-500");
    tabLogin?.classList.remove("text-gray-400");
    tabSignup?.classList.remove("text-white", "border-blue-500");
    tabSignup?.classList.add("text-gray-400");
    loginForm?.classList.remove("hidden");
    signupForm?.classList.add("hidden");
  });

  tabSignup?.addEventListener("click", () => {
    tabSignup?.classList.add("text-white", "border-blue-500");
    tabSignup?.classList.remove("text-gray-400");
    tabLogin?.classList.remove("text-white", "border-blue-500");
    tabLogin?.classList.add("text-gray-400");
    signupForm?.classList.remove("hidden");
    loginForm?.classList.add("hidden");
  });

  // Check Session
  async function initAuth() {
    try {
      const user = await account.get();
      if (user) {
        loginBtn?.classList.add("hidden");
        userProfile?.classList.remove("hidden");
        if (userName) userName.innerText = user.name;
        document.dispatchEvent(
          new CustomEvent("userLoggedIn", { detail: user }),
        );
      }
    } catch (e) {
      // Not logged in
    }
  }

  // Login Handler
  loginForm?.addEventListener("submit", async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target as HTMLFormElement);
    const email = formData.get("email") as string;
    const password = formData.get("password") as string;

    try {
      await account.createEmailPasswordSession(email, password);
      authModal?.classList.add("hidden");
      window.location.reload();
    } catch (err: any) {
      if (loginError) {
        loginError.innerText = err.message || "Login failed";
        loginError.classList.remove("hidden");
      }
    }
  });

  // Signup Handler
  signupForm?.addEventListener("submit", async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target as HTMLFormElement);
    const name = formData.get("name") as string;
    const email = formData.get("email") as string;
    const password = formData.get("password") as string;

    try {
      await account.create(ID.unique(), email, password, name);
      // Auto login after signup
      await account.createEmailPasswordSession(email, password);
      authModal?.classList.add("hidden");
      window.location.reload();
    } catch (err: any) {
      if (signupError) {
        signupError.innerText = err.message || "Signup failed";
        signupError.classList.remove("hidden");
      }
    }
  });

  logoutBtn?.addEventListener("click", async () => {
    await account.deleteSession("current");
    window.location.reload();
  });

  initAuth();
</script>
